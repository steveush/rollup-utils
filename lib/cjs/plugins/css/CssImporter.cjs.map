{"version":3,"file":"CssImporter.cjs","sources":["../../../../src/plugins/css/CssImporter.js"],"sourcesContent":["import MagicString from \"magic-string\";\r\nimport * as sass from \"sass\";\r\n\r\nimport Importer from \"../../utils/Importer.js\";\r\nimport SourceMap from \"../../utils/SourceMap.js\";\r\n\r\n/**\r\n * An instance of the SASS compiler so it can be used across multiple calls to the transform callback.\r\n *\r\n * @type {import('sass').Compiler}\r\n */\r\nconst SASS_COMPILER = sass.initCompiler();\r\n\r\n/**\r\n * The default options for the CSSTransformer class.\r\n *\r\n * @type {Readonly<ImporterOptions>}\r\n */\r\nconst CSS_IMPORTER_DEFAULTS = Object.freeze( Importer.options( {\r\n    include: [ \"**/*.css\", \"**/*.scss\", \"**/*.sass\" ],\r\n    output: \"[name].css\",\r\n    sourcemapComments: \"multiline\",\r\n    transform: ( ctx, code, id ) => {\r\n        const result = SASS_COMPILER.compile( id, {\r\n            sourceMap: true,\r\n            sourceMapIncludeSources: true,\r\n            style: \"compressed\"\r\n        } );\r\n        return {\r\n            code: result.css,\r\n            map: SourceMap.from( result.sourceMap )\r\n        };\r\n    },\r\n    types: {\r\n        css: ( ctx, module ) => {\r\n            return new MagicString( module.code )\r\n                .replaceAll( /`/g, \"\\\\`\" )\r\n                .prepend( \"const sheet = new CSSStyleSheet();\\nsheet.replaceSync(`\" )\r\n                .append( \"`);\\nexport default sheet;\" );\r\n        },\r\n        style: ( ctx, module ) => {\r\n            return new MagicString( module.code )\r\n                .replaceAll( /`/g, \"\\\\`\" )\r\n                .prepend( \"const style = document.createElement( \\\"style\\\" );\\nstyle.textContent = `\" )\r\n                .append( \"`;\\nexport default style;\" );\r\n        }\r\n    }\r\n} ) );\r\n\r\n/**\r\n * An {@link Importer} configured for importing CSS, SASS and SCSS files.\r\n *\r\n * @param {ImporterOptions} [options] - Optional. The options to supply for this instance of the class.\r\n */\r\nexport default class CssImporter extends Importer {\r\n    /**\r\n     * The readonly default options for this class.\r\n     *\r\n     * @returns {Readonly<ImporterOptions>}\r\n     */\r\n    static get defaults() {\r\n        return CSS_IMPORTER_DEFAULTS;\r\n    }\r\n\r\n    /**\r\n     * Create a new instance of the class with the given options.\r\n     *\r\n     * @param {ImporterOptions} [options] - Optional. The options to supply for this instance of the class.\r\n     */\r\n    constructor( options = {} ) {\r\n        super( options );\r\n    }\r\n};"],"names":["SASS_COMPILER","sass","initCompiler","CSS_IMPORTER_DEFAULTS","Object","freeze","Importer","options","include","output","sourcemapComments","transform","ctx","code","id","result","compile","sourceMap","sourceMapIncludeSources","style","css","map","SourceMap","from","types","module","MagicString","replaceAll","prepend","append","CssImporter","defaults","constructor","arguments","length","undefined"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA,MAAMA,aAAa,GAAGC,eAAI,CAACC,YAAY,EAAE,CAAA;;AAEzC;AACA;AACA;AACA;AACA;AACA,MAAMC,qBAAqB,GAAGC,MAAM,CAACC,MAAM,CAAEC,QAAQ,CAACC,OAAO,CAAE;AAC3DC,EAAAA,OAAO,EAAE,CAAE,UAAU,EAAE,WAAW,EAAE,WAAW,CAAE;AACjDC,EAAAA,MAAM,EAAE,YAAY;AACpBC,EAAAA,iBAAiB,EAAE,WAAW;AAC9BC,EAAAA,SAAS,EAAEA,CAAEC,GAAG,EAAEC,IAAI,EAAEC,EAAE,KAAM;AAC5B,IAAA,MAAMC,MAAM,GAAGf,aAAa,CAACgB,OAAO,CAAEF,EAAE,EAAE;AACtCG,MAAAA,SAAS,EAAE,IAAI;AACfC,MAAAA,uBAAuB,EAAE,IAAI;AAC7BC,MAAAA,KAAK,EAAE,YAAA;AACX,KAAE,CAAC,CAAA;IACH,OAAO;MACHN,IAAI,EAAEE,MAAM,CAACK,GAAG;AAChBC,MAAAA,GAAG,EAAEC,SAAS,CAACC,IAAI,CAAER,MAAM,CAACE,SAAU,CAAA;KACzC,CAAA;GACJ;AACDO,EAAAA,KAAK,EAAE;AACHJ,IAAAA,GAAG,EAAEA,CAAER,GAAG,EAAEa,MAAM,KAAM;MACpB,OAAO,IAAIC,WAAW,CAAED,MAAM,CAACZ,IAAK,CAAC,CAChCc,UAAU,CAAE,IAAI,EAAE,KAAM,CAAC,CACzBC,OAAO,CAAE,yDAA0D,CAAC,CACpEC,MAAM,CAAE,4BAA6B,CAAC,CAAA;KAC9C;AACDV,IAAAA,KAAK,EAAEA,CAAEP,GAAG,EAAEa,MAAM,KAAM;MACtB,OAAO,IAAIC,WAAW,CAAED,MAAM,CAACZ,IAAK,CAAC,CAChCc,UAAU,CAAE,IAAI,EAAE,KAAM,CAAC,CACzBC,OAAO,CAAE,2EAA4E,CAAC,CACtFC,MAAM,CAAE,2BAA4B,CAAC,CAAA;AAC9C,KAAA;AACJ,GAAA;AACJ,CAAE,CAAE,CAAC,CAAA;;AAEL;AACA;AACA;AACA;AACA;AACe,MAAMC,WAAW,SAASxB,QAAQ,CAAC;AAC9C;AACJ;AACA;AACA;AACA;EACI,WAAWyB,QAAQA,GAAG;AAClB,IAAA,OAAO5B,qBAAqB,CAAA;AAChC,GAAA;;AAEA;AACJ;AACA;AACA;AACA;AACI6B,EAAAA,WAAWA,GAAiB;AAAA,IAAA,IAAfzB,OAAO,GAAA0B,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAG,EAAE,CAAA;IACrB,KAAK,CAAE1B,OAAQ,CAAC,CAAA;AACpB,GAAA;AACJ;;;;"}